{% load humanize static unicorn %}

<div>
    <table style="width: 100%; border-top: 0;">
        <tr>
            <td style="padding-bottom: 10px;">
                <label for="username">Username</label>
                <input u:model.defer="mastodon_username" u:keydown.enter="get_results" id="username"
                    placeholder="@username"></input>
            </td>
            <td style="padding-bottom: 10px;">
                <label for="base_url">Base URL</label>
                <input u:model.defer="mastodon_base_url" u:keydown.enter="get_results" id="base_url"
                    placeholder="https://mastodon.social"></input>
            </td>
        </tr>
        <tr>
            <td colspan="2" style="padding-top: 0">
                <label for="token">Token</label>
                <input u:model.defer="mastodon_token" u:keydown.enter="get_results" id="token"></input>
                <p class="help">
                    Generate a token by going to <em>Edit profile</em>
                    -> <em>Development</em> -> <em>New application</em>. Only
                    <strong>read</strong> access is required.
                </p>
            </td>
        </tr>
    </table>

    <table class="config">
        <tr>
            <td>
                <label for="timeline">Timeline</label>
                <select u:model.defer="timeline" id="timeline">
                    <option value="home">Home</option>
                    <option value="local">Local</option>
                    <option value="federated">Federated</option>
                </select>
            </td>
            <td>
                <label for="scorer">Algorithm</label>
                <select u:model.defer="scorer" id="scorer">
                    <option value="Simple">Simple</option>
                    <option value="SimpleWeighted">Simple Weighted</option>
                    <option value="ExtendedSimple">Extended Simple</option>
                    <option value="ExtendedSimpleWeighted">Extended Simple Weighted</option>
                </select>
            </td>
            <td>
                <label for="threshold">Threshold</label>
                <select u:model.defer="threshold" id="threshold">
                    <option value="lax">Lax (90)</option>
                    <option value="normal">Normal (95)</option>
                    <option value="strict">Strict (98)</option>
                </select>
            </td>
        </tr>
        <tr>
            <td></td>
            <td class="hours">
                <label for="hours" id="hoursLabel">Hours</label>
                <input type="range" min="1" max="24" u:model.defer="hours" id="hours">
                <span id="hoursValue">{{ hours }}</span>
            </td>
            <td></td>
        </tr>
    </table>

    <div u:loading.remove style="padding-top: 10px; text-align: center;">
        <button u:click="get_results">Get Popular Toots</button>
    </div>
    <div u:loading style="padding-top: 10px; text-align: center;">
        <em>Building digest... this might take a few seconds...</em>
        <div style="padding-top: 100px;">
            <img src="{% static 'img/ball-triangle.svg' %}" />
        </div>
    </div>

    {% if error or unicorn.errors %}
    <div class="errors" u:loading.remove>
        <ul>
            {% if error %}
            <li>
                {{ error }}
            </li>
            {% else %}

            <!-- base URL -->
            {% for field in unicorn.errors.mastodon_base_url %}
            {% for error in field.message %}
            <li>
                <a href="#base_url" onclick="document.getElementById('base_url').focus();">{{ error }}</a>
            </li>
            {% endfor %}
            {% endfor %}

            <!-- token -->
            {% for field in unicorn.errors.mastodon_token %}
            {% for error in field.message %}
            <li>
                <a href="#token" onclick="document.getElementById('token').focus();">{{ error }}</a>
            </li>
            {% endfor %}
            {% endfor %}

            <!-- username -->
            {% for field in unicorn.errors.mastodon_username %}
            {% for error in field.message %}
            <li>
                <a href=" #username" onclick="document.getElementById('username').focus();">{{ error }}</a>
            </li>
            {% endfor %}
            {% endfor %}

            {% endif %}
        </ul>
    </div>
    {% endif %}

    {% if has_results %}
    <div class="results">
        <section class="posts" u:loading.remove style="">
            <h2>Popular Posts</h2>

            {% if posts %}
            {% with posts=posts %}
            {% include "www/posts.html" %}
            {% endwith %}
            {% else %}
            No posts available.
            {% endif %}
        </section>

        <section class="boosts" u:loading.remove style="">
            <h2>Popular Boosts</h2>

            {% if boosts %}
            {% with posts=boosts %}
            {% include "www/posts.html" %}
            {% endwith %}
            {% else %}
            No boosts available.
            {% endif %}
        </section>
    </div>

    {% comment %}Re-init GLightbox so that it picks up any new images that get loaded{% endcomment %}
    <script>
        const lightbox = GLightbox({});
    </script>
    {% endif %}
</div>